
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Review Admin</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }
    .review {
      background: #222;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid gold;
      border-radius: 10px;
    }
    .stars span {
      cursor: pointer;
      font-size: 1.5rem;
      color: #444;
      transition: color 0.2s;
    }
    .stars span.selected {
      color: gold;
    }
    button {
      padding: 5px 10px;
      background-color: gold;
      border: none;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Validate Reviews</h1>
  <div id="admin-list"></div>
  <button onclick="downloadJSON()">ðŸ’¾ Download Updated JSON</button>

  <script>
    let reviews = [];
    fetch('reviews.json')
      .then(res => res.json())
      .then(data => {
        reviews = data;
        showPendingReviews();
      });

    function showPendingReviews() {
      const container = document.getElementById('admin-list');
      container.innerHTML = '';
      reviews.forEach((review, index) => {
        if (!review.approved) {
          const div = document.createElement('div');
          div.className = 'review';
          const starsHTML = getStarsHTML(review.rating || 0, index);
          div.innerHTML = `
            <p><strong>${review.name}</strong> (${review.date})</p>
            <p>${review.comment}</p>
            <div class="stars" id="stars-${index}">${starsHTML}</div>
            <button onclick="approve(${index})">âœ… Valider</button>
          `;
          container.appendChild(div);
          setStarClickHandlers(index);
        }
      });
    }

    function getStarsHTML(rating, index) {
      let html = '';
      for (let i = 1; i <= 5; i++) {
        const selected = i <= rating ? 'selected' : '';
        html += `<span data-index="${index}" data-star="${i}" class="${selected}">â˜…</span>`;
      }
      return html;
    }

    function setStarClickHandlers(index) {
      const starContainer = document.getElementById(`stars-${index}`);
      const stars = starContainer.querySelectorAll('span');
      stars.forEach(star => {
        star.addEventListener('click', () => {
          const newRating = parseInt(star.getAttribute('data-star'));
          reviews[index].rating = newRating;
          starContainer.innerHTML = getStarsHTML(newRating, index);
          setStarClickHandlers(index);
        });
      });
    }

    function approve(index) {
      reviews[index].approved = true;
      showPendingReviews();
    }

    function downloadJSON() {
      const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(reviews, null, 2));
      const dlAnchor = document.createElement('a');
      dlAnchor.setAttribute("href", dataStr);
      dlAnchor.setAttribute("download", "reviews.json");
      document.body.appendChild(dlAnchor);
      dlAnchor.click();
      dlAnchor.remove();
    }
  </script>
</body>
</html>
